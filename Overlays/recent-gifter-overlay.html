<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Recent Gifter - Top Left</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Anton&family=Inter:wght@400;700;900&display=swap');

        @property --mask-stop {
            syntax: '<percentage>';
            initial-value: 85%;
            inherits: false;
        }

        :root {
            /* === Color Group 4: Mono/Metallic === */
            --fabric-dark: #050505;
            --fabric-mid: #151515;
            --fabric-bright: #252525;
            --fabric-mid2: #1a1a1a;
            --fabric-deep: #0a0a0a;

            /* === Color Group 2: Accent === */
            --neon-green: #ffffff;
            /* White toggle */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 1s ease, color 1s ease, border-color 1s ease, box-shadow 1s ease;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            background: transparent;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }

        .gifter-anchor {
            position: fixed;
            top: 25px;
            left: 50%;
            width: 840px;
            height: 140px;
            border-radius: 0 0 60px 60px;
            overflow: hidden;
            filter: drop-shadow(8px 8px 24px rgba(0, 0, 0, 0.4));
            transform: translateX(-50%) translateY(-110%) scale(0.5);
            transform-origin: top center;
            opacity: 0;
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease;
            -webkit-mask-image: linear-gradient(to right,
                    rgba(0, 0, 0, 1) 0%,
                    rgba(0, 0, 0, 1) 60%,
                    rgba(0, 0, 0, 0.4) var(--mask-stop),
                    transparent 100%);
            mask-image: linear-gradient(to right,
                    rgba(0, 0, 0, 1) 0%,
                    rgba(0, 0, 0, 1) 60%,
                    rgba(0, 0, 0, 0.4) var(--mask-stop),
                    transparent 100%);
            perspective: 1200px;
            will-change: transform;
        }

        .wave-container {
            position: absolute;
            inset: -40px;
            width: calc(100% + 80px);
            height: calc(100% + 80px);
            transform-style: preserve-3d;
            --phase: 0;
            --crest: 0;
            --flash: 0;
            --sway-x: 0px;
            --sway-y: 0px;
            --tilt-x: 0deg;
            --tilt-y: 0deg;
            --wave-scale: 1.006;
            --sheen-pos: 48%;
            --rim-alpha: 0.34;
            --poly-alpha: 0.36;
            transform:
                translateX(var(--sway-x)) translateY(var(--sway-y)) rotateY(var(--tilt-y)) rotateX(var(--tilt-x)) scale(var(--wave-scale));
            will-change: transform;
        }

        .gifter-anchor.slide-in {
            transform: translateX(-50%) translateY(0) scale(0.5);
            opacity: 1;
        }

        .gifter-anchor.slide-out {
            transform: translateX(-50%) translateY(-110%) scale(0.5);
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.55, 0, 1, 0.45), opacity 0.3s ease;
        }

        .inner-fill {
            position: absolute;
            inset: 30px;
            border-radius: 0 0 60px 60px;
            background: #000000;
            /* FORCE BLACK */
            /* Optional: Subtle gradient if desired, but base is black */
            background-image: linear-gradient(145deg, #0a0a0a 0%, #000000 100%);
            box-shadow:
                inset 0 2px 0 rgba(255, 255, 255, 0.4),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                inset 2px 0 0 rgba(255, 255, 255, 0.15),
                inset -2px 0 0 rgba(255, 255, 255, 0.15),
                inset 0 4px 15px rgba(255, 255, 255, 0.2),
                inset 0 -4px 10px rgba(0, 0, 0, 0.15);
            z-index: 2;
            overflow: hidden;
            filter: url(#fabric-ripple-bg);
            will-change: filter;
        }

        .poly-sheen {
            position: absolute;
            inset: 0;
            z-index: 7;
            pointer-events: none;
            mix-blend-mode: screen;
            opacity: var(--poly-alpha);
            background:
                linear-gradient(118deg,
                    transparent 6%,
                    rgba(255, 255, 255, calc(0.04 + var(--crest) * 0.06)) 28%,
                    rgba(255, 255, 255, calc(0.14 + var(--crest) * 0.14 + var(--flash) * 0.20)) var(--sheen-pos),
                    rgba(255, 255, 255, calc(0.04 + var(--crest) * 0.06)) calc(var(--sheen-pos) + 16%),
                    transparent 88%),
                linear-gradient(168deg,
                    rgba(255, 255, 255, calc(0.03 + var(--flash) * 0.08)) 0%,
                    transparent 32%,
                    transparent 68%,
                    rgba(255, 255, 255, calc(0.04 + var(--flash) * 0.10)) 100%);
        }

        .rim-light {
            position: absolute;
            inset: 0;
            z-index: 8;
            pointer-events: none;
            background:
                linear-gradient(to right,
                    rgba(255, 255, 255, calc(var(--rim-alpha) * 0.85 + var(--flash) * 0.12)) 0%,
                    transparent 14%,
                    transparent 86%,
                    rgba(255, 255, 255, calc(var(--rim-alpha) * 0.75 + var(--flash) * 0.10)) 100%),
                linear-gradient(to bottom,
                    rgba(255, 255, 255, calc(0.18 + var(--crest) * 0.12 + var(--flash) * 0.12)) 0%,
                    rgba(255, 255, 255, 0) 45%);
            mix-blend-mode: soft-light;
        }

        .micro-noise {
            position: absolute;
            inset: 0;
            z-index: 9;
            pointer-events: none;
            opacity: calc(0.06 + var(--crest) * 0.04 + var(--flash) * 0.03);
            mix-blend-mode: overlay;
            background:
                repeating-linear-gradient(22deg,
                    rgba(255, 255, 255, 0.10) 0px,
                    rgba(255, 255, 255, 0.10) 1px,
                    transparent 1px,
                    transparent 3px),
                repeating-linear-gradient(112deg,
                    rgba(0, 0, 0, 0.10) 0px,
                    rgba(0, 0, 0, 0.10) 1px,
                    transparent 1px,
                    transparent 4px);
        }

        .glass-overlay {
            position: absolute;
            inset: 0;
            background:
                linear-gradient(to bottom,
                    rgba(255, 255, 255, 0.30) 0%,
                    rgba(255, 255, 255, 0.12) 30%,
                    transparent 50%,
                    rgba(0, 0, 0, 0.06) 70%,
                    rgba(0, 0, 0, 0.12) 100%),
                linear-gradient(110deg,
                    transparent 0%,
                    rgba(255, 255, 255, 0.08) 30%,
                    rgba(255, 255, 255, 0.15) 50%,
                    rgba(255, 255, 255, 0.08) 70%,
                    transparent 100%);
            z-index: 15;
            pointer-events: none;
            opacity: calc(0.80 + var(--crest) * 0.14 + var(--flash-ui, 0) * 0.12);
        }

        .content-layer {
            position: absolute;
            inset: 30px;
            border-radius: 0 0 52px 52px;
            z-index: 16;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 24px;
            padding: 0 40px 0 28px;
            filter: url(#fabric-ripple-fg);
            will-change: filter;
        }

        .lightning-wash {
            position: absolute;
            inset: 30px;
            z-index: 18;
            pointer-events: none;
            border-radius: 0 0 52px 52px;
            mix-blend-mode: screen;
            opacity: calc(var(--flash-bg, 0) * 0.40);
            background:
                radial-gradient(120% 110% at 50% -20%,
                    rgba(255, 255, 255, 0.45),
                    /* Pure White Flash */
                    rgba(255, 255, 255, 0.20) 45%,
                    rgba(255, 255, 255, 0) 80%),
                linear-gradient(120deg,
                    rgba(255, 255, 255, 0) 0%,
                    rgba(255, 255, 255, 0.18) 50%,
                    rgba(255, 255, 255, 0) 100%);
        }

        .kick-icon {
            width: 80px;
            height: 80px;
            flex-shrink: 0;
            filter: drop-shadow(0 0 16px rgba(255, 255, 255, 0.5));
            transform: rotateZ(-5deg);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-3d {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transform: rotateY(-10deg);
        }

        .logo-face {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .logo-face img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: brightness(1.5) contrast(1.25) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }

        .logo-front {
            transform: translateZ(6px);
        }

        .logo-back {
            transform: rotateY(180deg) translateZ(6px);
        }

        .logo-edge {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .logo-edge img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: brightness(0.9) contrast(1.25);
        }

        .gifter-text-group {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 0;
        }

        .gifter-label {
            font-family: 'Anton', sans-serif;
            font-size: 24px;
            letter-spacing: 2px;
            color: transparent;
            background: linear-gradient(180deg, #ffffff 0%, #e0e0e0 40%, #b0b0b0 100%);
            -webkit-background-clip: text;
            background-clip: text;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
            text-transform: uppercase;
            margin-bottom: -4px;
        }

        .gifter-name {
            font-family: 'Inter', sans-serif;
            font-size: 64px;
            font-weight: 900;
            line-height: 1;
            letter-spacing: 2px;
            text-transform: uppercase;
            background: linear-gradient(180deg,
                    #ffffff 0%,
                    #e0e0e0 45%,
                    #a0a0a0 50%,
                    #d0d0d0 60%,
                    #909090 80%,
                    #404040 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            -webkit-text-stroke: 1px rgba(255, 255, 255, 0.1);
            filter: drop-shadow(0 2px 0 rgba(0, 0, 0, 0.5));
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 600px;
            text-transform: uppercase;
            /* Enforce Uppercase */
        }

        .gifter-flash {
            animation: gifter-pop 0.8s cubic-bezier(0.16, 1, 0.3, 1) both !important;
        }

        @keyframes gifter-pop {
            0% {
                filter: brightness(5) drop-shadow(0 0 30px #fff);
                transform: scale(1.1);
            }

            100% {
                filter: brightness(1) drop-shadow(0 1px 0 rgba(255, 255, 255, 0.25));
                transform: scale(1);
            }
        }

        .gold-applied .gifter-name {
            background: linear-gradient(180deg,
                    #ffed8a 0%,
                    #fcd04d 25%,
                    #d4af37 50%,
                    #8a6d3b 75%,
                    #d4af37 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-stroke: 1px rgba(255, 230, 0, 0.4);
            filter:
                drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8)) drop-shadow(0 0 20px rgba(212, 175, 55, 0.8)) drop-shadow(0 0 30px rgba(255, 215, 0, 0.4));
        }

        .gold-applied.gifter-anchor {
            box-shadow: 4px 4px 25px rgba(212, 175, 55, 0.4);
        }

        @media (prefers-reduced-motion: reduce) {
            .wave-container {
                transform: none;
            }

            .inner-fill,
            .content-layer {
                filter: none;
            }

            .poly-sheen,
            .rim-light,
            .micro-noise,
            .lightning-wash {
                display: none;
            }
        }
    </style>
</head>

<body>

    <div class="gifter-anchor" id="gifter-anchor">
        <div class="wave-container" id="wave-container">
            <div class="inner-fill">
                <div class="poly-sheen"></div>
                <div class="rim-light"></div>
                <div class="micro-noise"></div>
                <div class="glass-overlay"></div>
            </div>

            <div class="content-layer">
                <!-- Gift Icon (SVG) -->
                <div class="kick-icon">
                    <img src="../Logo/gift-icon.svg" alt="Gift" style="width: 100%; height: 100%;">
                </div>

                <div class="gifter-text-group">
                    <div class="gifter-label">LATEST GIFTER</div>
                    <div class="gifter-name" id="gifter-name"></div>
                </div>
            </div>

            <div class="lightning-wash"></div>

            <svg style="position: absolute; width: 0; height: 0;" aria-hidden="true">
                <filter id="fabric-ripple-bg" x="-50%" y="-50%" width="200%" height="200%"
                    filterUnits="objectBoundingBox" color-interpolation-filters="sRGB">
                    <feTurbulence type="fractalNoise" baseFrequency="0.005 0.009" numOctaves="4" seed="3"
                        stitchTiles="stitch" width="200" height="200" result="noise_tile" />
                    <feTile in="noise_tile" result="tiled_noise" />
                    <feOffset id="noise-scroll-primary" in="tiled_noise" dx="0" dy="0" result="scrolled_noise" />
                    <feGaussianBlur in="scrolled_noise" stdDeviation="2.2" result="smooth_noise" />

                    <feTurbulence type="fractalNoise" baseFrequency="0.01 0.02" numOctaves="2" seed="9"
                        stitchTiles="stitch" width="100" height="100" result="noise_tile_soft" />
                    <feTile in="noise_tile_soft" result="tiled_noise_soft" />
                    <feOffset id="noise-scroll-secondary" in="tiled_noise_soft" dx="0" dy="0"
                        result="scrolled_noise_soft" />
                    <feGaussianBlur in="scrolled_noise_soft" stdDeviation="1.5" result="smooth_noise_soft" />

                    <feDisplacementMap in="SourceGraphic" in2="smooth_noise" scale="24" xChannelSelector="R"
                        yChannelSelector="G" result="primary_warp" />
                    <feDisplacementMap in="primary_warp" in2="smooth_noise_soft" scale="8" xChannelSelector="R"
                        yChannelSelector="G" />
                </filter>

                <filter id="fabric-ripple-fg" x="-35%" y="-35%" width="170%" height="170%"
                    filterUnits="objectBoundingBox" color-interpolation-filters="sRGB">
                    <feTurbulence type="fractalNoise" baseFrequency="0.0045 0.008" numOctaves="2" seed="4"
                        stitchTiles="stitch" width="200" height="200" result="fg_noise_tile" />
                    <feTile in="fg_noise_tile" result="fg_tiled_noise" />
                    <feOffset id="noise-scroll-foreground" in="fg_tiled_noise" dx="0" dy="0"
                        result="fg_scrolled_noise" />
                    <feGaussianBlur in="fg_scrolled_noise" stdDeviation="1.1" result="fg_smooth_noise" />
                    <feDisplacementMap in="SourceGraphic" in2="fg_smooth_noise" scale="5" xChannelSelector="R"
                        yChannelSelector="G" />
                </filter>
            </svg>

            <script>
                const BASE_POLL_INTERVAL = 300;
                const RENDER_MODE = 'full'; // 'full' | 'safe'
                const WAVE_SPEED = 1.18;
                const MAX_FLASH_BG = RENDER_MODE === 'safe' ? 0.28 : 0.62;
                const MAX_FLASH_UI = RENDER_MODE === 'safe' ? 0.12 : 0.34;
                let lastGifterId = '';

                const container = document.getElementById('gifter-anchor');
                const waveEl = document.getElementById('wave-container');
                const nameEl = document.getElementById('gifter-name');
                const reduceMotionQuery = window.matchMedia('(prefers-reduced-motion: reduce)');

                const noisePrimary = document.getElementById('noise-scroll-primary');
                const noiseSecondary = document.getElementById('noise-scroll-secondary');
                const noiseForeground = document.getElementById('noise-scroll-foreground');

                let phase = 0;
                let lastFrame = performance.now();
                let flash = 0;
                let nextFlashAt = performance.now() + 3500;
                let isBannerVisible = false;
                let pollIntervalMs = BASE_POLL_INTERVAL;
                let pollTimer = null;
                let pollFailures = 0;

                function clamp(val, min, max) {
                    return Math.min(max, Math.max(min, val));
                }

                function setWaveVar(name, value) {
                    waveEl.style.setProperty(name, value);
                }

                function resetMotionState() {
                    setWaveVar('--sway-x', '0px');
                    setWaveVar('--sway-y', '0px');
                    setWaveVar('--tilt-x', '0deg');
                    setWaveVar('--tilt-y', '0deg');
                    setWaveVar('--wave-scale', '1.006');
                    setWaveVar('--crest', '0');
                    setWaveVar('--flash', '0');
                    setWaveVar('--flash-bg', '0');
                    setWaveVar('--flash-ui', '0');
                    setWaveVar('--sheen-pos', '48%');
                    setWaveVar('--rim-alpha', '0.34');
                    setWaveVar('--poly-alpha', '0.36');
                    if (noisePrimary) noisePrimary.setAttribute('dx', '0');
                    if (noiseSecondary) noiseSecondary.setAttribute('dx', '0');
                    if (noiseForeground) noiseForeground.setAttribute('dx', '0');
                }

                function shouldAnimate() {
                    return !reduceMotionQuery.matches && !document.hidden && isBannerVisible;
                }

                function updateFabricFrame(ts) {
                    const dt = clamp((ts - lastFrame) / 1000, 0, 0.05);
                    lastFrame = ts;

                    if (shouldAnimate()) {
                        phase += dt * WAVE_SPEED;

                        const primary = Math.sin(phase);
                        const secondary = Math.sin(phase * 1.37 + 0.9);
                        const crest = clamp((primary * 0.72 + secondary * 0.28 + 1) * 0.5, 0, 1);

                        const swayX = primary * 7 + secondary * 1.8;
                        const swayY = Math.sin(phase * 0.82 + 1.1) * 2.2;
                        const tiltY = primary * 1.8 + secondary * 0.35;
                        const tiltX = Math.sin(phase * 0.9 + 0.3) * 0.62;
                        const scale = 1.006 + crest * 0.006;

                        flash = Math.max(0, flash - dt * 2.9);
                        if (ts >= nextFlashAt && crest > 0.78) {
                            flash = 0.9;
                            nextFlashAt = ts + 3200 + Math.random() * 5200;
                        }
                        const flashBg = clamp(flash * 0.55, 0, MAX_FLASH_BG);
                        const flashUi = clamp(flash * 0.30, 0, MAX_FLASH_UI);

                        const sheenPos = clamp(48 + primary * 12 + secondary * 5, 28, 74);
                        const rimAlpha = clamp(0.22 + Math.abs(tiltY) * 0.045 + crest * 0.08 + flash * 0.12, 0.2, 0.6);
                        const polyAlpha = clamp(0.24 + crest * 0.16 + flash * 0.18, 0.2, 0.62);

                        setWaveVar('--phase', phase.toFixed(4));
                        setWaveVar('--crest', crest.toFixed(3));
                        setWaveVar('--flash', flash.toFixed(3));
                        setWaveVar('--flash-bg', flashBg.toFixed(3));
                        setWaveVar('--flash-ui', flashUi.toFixed(3));
                        setWaveVar('--sway-x', `${swayX.toFixed(2)}px`);
                        setWaveVar('--sway-y', `${swayY.toFixed(2)}px`);
                        setWaveVar('--tilt-y', `${tiltY.toFixed(2)}deg`);
                        setWaveVar('--tilt-x', `${tiltX.toFixed(2)}deg`);
                        setWaveVar('--wave-scale', scale.toFixed(4));
                        setWaveVar('--sheen-pos', `${sheenPos.toFixed(2)}%`);
                        setWaveVar('--rim-alpha', rimAlpha.toFixed(3));
                        setWaveVar('--poly-alpha', polyAlpha.toFixed(3));

                        const cycleA = ((phase % (Math.PI * 2)) / (Math.PI * 2)) * 200;
                        const cycleB = (((phase * 1.37) % (Math.PI * 2)) / (Math.PI * 2)) * 100;
                        const cycleFg = (((phase * 0.82) % (Math.PI * 2)) / (Math.PI * 2)) * 200;
                        if (noisePrimary) noisePrimary.setAttribute('dx', cycleA.toFixed(2));
                        if (noiseSecondary) noiseSecondary.setAttribute('dx', cycleB.toFixed(2));
                        if (noiseForeground) noiseForeground.setAttribute('dx', cycleFg.toFixed(2));
                    } else if (!isBannerVisible || document.hidden) {
                        flash = Math.max(0, flash - dt * 4.5);
                        setWaveVar('--flash', flash.toFixed(3));
                        setWaveVar('--flash-bg', '0');
                        setWaveVar('--flash-ui', '0');
                    }

                    requestAnimationFrame(updateFabricFrame);
                }

                function showGifter(name, id) {
                    if (!name) return;
                    if (id && id === lastGifterId) return;
                    lastGifterId = id;
                    isBannerVisible = true;

                    container.classList.remove('slide-in');
                    nameEl.classList.remove('gifter-flash');
                    void container.offsetWidth;

                    nameEl.textContent = name;
                    container.classList.add('slide-in');
                    nameEl.classList.add('gifter-flash');
                }

                // Tips logic removed as per user request
                window.updateTips = function (name, amount, id) {
                    // No-op
                };

                window.updateFollowers = function (val, extra, id) {
                    // extra format: "Latest: Username"
                    let name = extra;
                    if (extra && extra.includes(':')) {
                        name = extra.split(':')[1].trim();
                    }
                    if (name && name !== '-') {
                        showGifter(name, id);
                        container.classList.remove('gold-applied');
                    }
                };

                function schedulePoll(ms) {
                    if (pollTimer) clearTimeout(pollTimer);
                    pollTimer = setTimeout(pollAll, ms);
                }

                function injectScript(filename, id) {
                    const old = document.getElementById(id);
                    if (old) old.remove();
                    const s = document.createElement('script');
                    s.src = filename + '?t=' + Date.now();
                    s.id = id;
                    s.async = true;
                    s.onload = () => {
                        pollFailures = 0;
                        pollIntervalMs = BASE_POLL_INTERVAL;
                        schedulePoll(pollIntervalMs);
                    };
                    s.onerror = () => {
                        pollFailures += 1;
                        pollIntervalMs = Math.min(BASE_POLL_INTERVAL * Math.pow(2, pollFailures), 8000);
                        schedulePoll(pollIntervalMs);
                    };
                    document.body.appendChild(s);
                }

                function pollAll() {
                    injectScript('../Data/data_followers.js', 'script-followers');
                    injectScript('../Settings/settings.js', 'script-settings');
                }

                function onMotionPreferenceChange() {
                    if (reduceMotionQuery.matches) {
                        resetMotionState();
                        applyRenderMode();
                    }
                }

                function applyRenderMode() {
                    if (RENDER_MODE !== 'safe') return;
                    setWaveVar('--poly-alpha', '0.22');
                    setWaveVar('--rim-alpha', '0.26');
                    const lightning = document.querySelector('.lightning-wash');
                    const noise = document.querySelector('.micro-noise');
                    if (lightning) lightning.style.display = 'none';
                    if (noise) noise.style.display = 'none';
                }

                if (typeof reduceMotionQuery.addEventListener === 'function') {
                    reduceMotionQuery.addEventListener('change', onMotionPreferenceChange);
                } else if (typeof reduceMotionQuery.addListener === 'function') {
                    reduceMotionQuery.addListener(onMotionPreferenceChange);
                }

                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) {
                        resetMotionState();
                        applyRenderMode();
                    }
                });

                resetMotionState();
                applyRenderMode();
                requestAnimationFrame(updateFabricFrame);
                pollAll();
            </script>

            <!-- Color Settings Loader -->
            <script src="../Settings/settings.js"></script>
            <script src="../Data/data_tips.js"></script>
            <script>
                (function () {
                    // ╔══════════════════════════════════════════════════════════════════╗
                    // ║              EMBEDDED SMOOTH HUE ENGINE                         ║
                    // ╚══════════════════════════════════════════════════════════════════╝

                    const BASE_COLORS = {
                        '--fabric-dark': 'rgba(5, 140, 45, 0.98)',
                        '--fabric-mid': 'rgba(15, 200, 70, 0.95)',
                        '--fabric-bright': 'rgba(30, 230, 90, 0.92)',
                        '--fabric-mid2': 'rgba(20, 200, 65, 0.95)',
                        '--fabric-deep': 'rgba(10, 170, 55, 0.98)',
                        '--wave-1': 'rgb(17, 153, 142)',
                        '--wave-2': 'rgb(37, 196, 134)',
                        '--wave-3': 'rgb(56, 239, 125)',
                        '--label-color': 'rgba(10, 255, 10, 0.7)',
                        '--border-accent': 'rgba(10, 255, 10, 0.6)'
                    };

                    const State = {
                        currentHue: 0,
                        targetHue: 0,
                        animationFrame: null
                    };

                    function lerp(start, end, factor) {
                        return start + (end - start) * factor;
                    }

                    function animate() {
                        const diff = State.targetHue - State.currentHue;
                        if (Math.abs(diff) > 0.05) {
                            State.currentHue = lerp(State.currentHue, State.targetHue, 0.08);
                            updateColors();
                            State.animationFrame = requestAnimationFrame(animate);
                        } else if (Math.abs(diff) > 0) {
                            State.currentHue = State.targetHue;
                            updateColors();
                            State.animationFrame = null;
                        } else {
                            State.animationFrame = null;
                        }
                    }

                    function updateColors() {
                        // Apply Brightness
                        const bright = window.GLOBAL_BRIGHTNESS !== undefined ? window.GLOBAL_BRIGHTNESS : 1.0;
                        document.documentElement.style.filter = `brightness(${bright})`;

                        // Hue logic (scoped)
                        if (!window.adjustHue) return;
                        if (window.GLOBAL_HUE_OFFSET !== undefined) {
                            const hueval = window.GLOBAL_HUE_OFFSET;
                            document.documentElement.style.setProperty('--accent-hue', hueval + 'deg');
                        }
                    }

                    function loadSettings() {
                        const old = document.getElementById('settings-script');
                        if (old) old.remove();

                        const s = document.createElement('script');
                        s.src = '../Settings/settings.js?t=' + Date.now();
                        s.id = 'settings-script';
                        s.onload = function () {
                            const newTarget = window.GLOBAL_HUE_OFFSET || 0;
                            if (newTarget !== State.targetHue) {
                                State.targetHue = newTarget;
                                if (!State.animationFrame) animate();
                            }
                        };
                        document.head.appendChild(s);
                    }

                    loadSettings();
                    setInterval(loadSettings, 1000);
                })();
            </script>
        </div>
    </div>
</body>

</html>